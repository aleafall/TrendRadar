name: Daily AI News Summary

on:
  schedule:
    # 北京时间 14:30 -> UTC 06:30
    - cron: '30 6 * * *'
    # 北京时间 22:00 -> UTC 14:00
    - cron: '0 14 * * *'
  workflow_dispatch:

jobs:
  analyze-and-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'  # 保持 3.11

    - name: Install dependencies
      run: |
        # 注意：这里改为了 google-genai
        pip install boto3 google-genai

    - name: Run AI Summary Script
      env:
        # R2 存储配置
        S3_BUCKET_NAME: ${{ secrets.S3_BUCKET_NAME }}
        S3_ACCESS_KEY_ID: ${{ secrets.S3_ACCESS_KEY_ID }}
        S3_SECRET_ACCESS_KEY: ${{ secrets.S3_SECRET_ACCESS_KEY }}
        S3_ENDPOINT_URL: ${{ secrets.S3_ENDPOINT_URL }}
        
        # Gemini 配置
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
        # 邮件配置
        SMTP_SERVER: "smtp.qq.com"
        SMTP_PORT: 465
        EMAIL_FROM: ${{ secrets.EMAIL_FROM}}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD}}
        EMAIL_TO: ${{ secrets.EMAIL_TO }}
        
      run: python scripts/ai_summary.py
